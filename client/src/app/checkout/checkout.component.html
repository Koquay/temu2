<div class="container mt-4">
  <form #checkoutForm="ngForm">
    <section>
      <div class="row">
        <div class="col col-12 col-lg-8">
          <section>
            <div class="row mb-4">
              <div class="col">
                <label class="form-label fw-bold">First Name</label>
                <input
                  class="form-control"
                  type="text"
                  name="firstName"
                  [(ngModel)]="checkoutData.deliveryAddress.firstName"
                  required
                  #firstName="ngModel"
                  (change)="saveCheckoutData()"
                  [ngClass]="{
                    'is-valid':
                      firstName.valid && (firstName.dirty || firstName.touched),
                    'is-invalid':
                      firstName.invalid &&
                      (firstName.dirty || firstName.touched)
                  }"
                />
                <div
                  *ngIf="
                    firstName.invalid && (firstName.dirty || firstName.touched)
                  "
                  class="alert"
                >
                  <div *ngIf="firstName.hasError('required')" class="alert">
                    <small>First Name is required.</small>
                  </div>
                </div>
              </div>
              <div class="col">
                <label class="form-label fw-bold">Last Name</label>
                <input
                  class="form-control"
                  type="text"
                  name="lastName"
                  [(ngModel)]="checkoutData.deliveryAddress.lastName"
                  required
                  #lastName="ngModel"
                  (change)="saveCheckoutData()"
                  [ngClass]="{
                    'is-valid':
                      lastName.valid && (lastName.dirty || lastName.touched),
                    'is-invalid':
                      lastName.invalid && (lastName.dirty || lastName.touched)
                  }"
                />
                <div
                  *ngIf="
                    lastName.invalid && (lastName.dirty || lastName.touched)
                  "
                  class="alert"
                >
                  <div *ngIf="lastName.hasError('required')">
                    <small>Last Name is required.</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mb-4">
              <div class="col">
                <label class="form-label fw-bold">Phone Number</label>
                <input
                  class="form-control"
                  type="text"
                  name="phone"
                  [(ngModel)]="checkoutData.deliveryAddress.phone"
                  required
                  #phone="ngModel"
                  (change)="saveCheckoutData()"
                  [ngClass]="{
                    'is-valid': phone.valid && (phone.dirty || phone.touched),
                    'is-invalid':
                      phone.invalid && (phone.dirty || phone.touched)
                  }"
                />
                <div
                  *ngIf="phone.invalid && (phone.dirty || phone.touched)"
                  class="alert"
                >
                  <div *ngIf="phone.hasError('required')">
                    <small>Phone is required.</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mb-4">
              <div class="col">
                <label class="form-label fw-bold">Delivery Address</label>
                <input
                  class="form-control"
                  type="text"
                  name="address1"
                  [(ngModel)]="checkoutData.deliveryAddress.address1"
                  required
                  #address1="ngModel"
                  (change)="saveCheckoutData()"
                  [ngClass]="{
                    'is-valid':
                      address1.valid && (address1.dirty || address1.touched),
                    'is-invalid':
                      address1.invalid && (address1.dirty || address1.touched)
                  }"
                />
                <div
                  *ngIf="
                    address1.invalid && (address1.dirty || address1.touched)
                  "
                  class="alert"
                >
                  <div *ngIf="address1.hasError('required')">
                    <small>Delivery Address is required.</small>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mb-4">
              <div class="col">
                <label class="form-label fw-bold"
                  >Delivery Address Line 2 (Optional)</label
                >
                <input
                  class="form-control"
                  type="text"
                  name="address2"
                  [(ngModel)]="checkoutData.deliveryAddress.address2"
                  #address2="ngModel"
                  (change)="saveCheckoutData()"
                />
              </div>
            </div>

            <div class="row mb-4">
              <div class="col">
                <label class="form-label fw-bold">Zip/Postal Code</label>
                <input
                  class="form-control"
                  type="text"
                  name="deliveryPostalCode"
                  [(ngModel)]="checkoutData.deliveryAddress.deliveryPostalCode"
                  required
                  #deliveryPostalCode="ngModel"
                  (change)="saveCheckoutData()"
                  [ngClass]="{
                    'is-valid':
                      deliveryPostalCode.valid &&
                      (deliveryPostalCode.dirty || deliveryPostalCode.touched),
                    'is-invalid':
                      deliveryPostalCode.invalid &&
                      (deliveryPostalCode.dirty || deliveryPostalCode.touched)
                  }"
                />
                <div
                  *ngIf="
                    deliveryPostalCode.invalid &&
                    (deliveryPostalCode.dirty || deliveryPostalCode.touched)
                  "
                  class="alert"
                >
                  <div *ngIf="deliveryPostalCode.hasError('required')">
                    <small>Delivery Zip/Postal Code is required.</small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row mb-4">
              <div class="col">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="formCheck-1"
                    name="useAsBillingAddress"
                    [(ngModel)]="
                      checkoutData.deliveryAddress.useAsBillingAddress
                    "
                    required
                    #useAsBillingAddress="ngModel"
                    (change)="saveCheckoutData()"
                  />
                  <label class="form-check-label fw-bold" for="formCheck-1"
                    >Use as Billing Address</label
                  >
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="row mb-4">
              <div class="col">
                <div class="form-check" name="">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="formCheck-2"
                    value="PayPal"
                    name="paymentMethod"
                    [(ngModel)]="checkoutData.paymentType"
                    (change)="onPaymentTypeChange(); saveCheckoutData()"
                  />
                  <label
                    class="form-check-label fw-bold"
                    for="formCheck-2"
                    style="font-style: italic"
                    >PayPal</label
                  >
                </div>
                <div class="form-check" name="">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="formCheck-3"
                    value="CreditCard"
                    name="paymentMethod"
                    [(ngModel)]="checkoutData.paymentType"
                    (change)="onPaymentTypeCreditCard(); saveCheckoutData()"
                  />
                  <label class="form-check-label fw-bold" for="formCheck-3"
                    >Credit Card</label
                  >
                </div>
              </div>
            </div>
          </section>

          <ng-container
            *ngIf="
              checkoutData?.paymentType === 'CreditCard';
              else payWithPayPal
            "
          >
            <div class="col-12 col-md-6">
              <h6 class="fw-bold">Enter Credit Card Info</h6>
              <div
                id="card-element"
                class="p-3 border rounded"
                style="border: 1px solid gray !important"
              ></div>

              <div class="col mt-2">
                <input
                  class="form-control"
                  type="text"
                  name="billingPostalCode"
                  [(ngModel)]="billingPostalCode"
                  required
                  placeholder="Zip or Postal Code"
                  #billingPostalCodeCtrl="ngModel"
                  (change)="saveCheckoutData()"
                  [ngClass]="{
                    'is-valid':
                      billingPostalCodeCtrl.valid &&
                      (billingPostalCodeCtrl.dirty ||
                        billingPostalCodeCtrl.touched),
                    'is-invalid':
                      billingPostalCodeCtrl.invalid &&
                      (billingPostalCodeCtrl.dirty ||
                        billingPostalCodeCtrl.touched)
                  }"
                />
                <div
                  *ngIf="
                    billingPostalCodeCtrl.invalid &&
                    (billingPostalCodeCtrl.dirty ||
                      billingPostalCodeCtrl.touched)
                  "
                  class="alert"
                >
                  <div *ngIf="billingPostalCodeCtrl.hasError('required')">
                    <small>Zip or Postal Code is required.</small>
                  </div>
                </div>
              </div>

              <button
                class="btn btn-primary w-100 primary-button mt-3"
                type="button"
                style="
                  font-size: 20px;
                  font-weight: bold;
                  background-color: #fb7701;
                  border-style: none;
                "
                [disabled]="!checkoutForm.valid || !clientSecret"
                (click)="placeOrder()"
              >
                Place Order
              </button>

              <ol class="mt-4">
                <li class="mt-4">
                  Payment Methods
                  <div class="d-flex justify-content-around">
                    <img
                      class="img-fluid"
                      src="assets/img/visa.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    /><img
                      class="img-fluid"
                      src="assets/img/AMEX.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    /><img
                      class="img-fluid"
                      src="assets/img/Discover.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    /><img
                      class="img-fluid"
                      src="assets/img/PayPal.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    />
                  </div>
                </li>
                <li class="mt-4">
                  Security Certification
                  <div class="d-flex justify-content-around">
                    <img
                      class="img-fluid"
                      src="assets/img/security%20certification%20%205.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    /><img
                      class="img-fluid"
                      src="assets/img/security%20certification%201.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    /><img
                      class="img-fluid"
                      src="assets/img/security%20certification%202.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    /><img
                      class="img-fluid"
                      src="assets/img/security%20certification%203.webp"
                      width="120"
                      height="80"
                      style="width: 48px"
                    />
                  </div>
                </li>
              </ol>
            </div>
          </ng-container>

          <ng-template #payWithPayPal>
            <section>
              <div class="row mb-4">
                <div class="col">
                  <h6>PayPal Payment</h6>
                  <p>TO BE IMPLEMENTED</p>
                  <!-- <div id="paypal-button-container"></div> -->
                </div>
              </div>
            </section>
          </ng-template>
        </div>
        <div class="col col-12 col-md-4">
          <app-order-summary (cartTotalEvent)="setCartTotal($event)" />
        </div>
      </div>
    </section>
  </form>
</div>
